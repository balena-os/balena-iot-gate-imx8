BBPATH .= ":${LAYERDIR}"

BBFILES += "${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend"

BBFILE_COLLECTIONS += "balena-imx8mm"
BBFILE_PATTERN_balena-imx8mm := "^${LAYERDIR}/"
BBFILE_PRIORITY_balena-imx8mm = "1337"
LAYERSERIES_COMPAT_balena-imx8mm = "dunfell"

BBMASK += "compulab-ucm-imx8m-mini.bb"
BBMASK += "u-boot-imx-fw-utils_2019.04.bb"
BBMASK += "compulab-qt5-build-env.bb"
BBMASK += "u-boot-fw-utils_%.bbappend"
BBMASK += "meta-compulab-bsp/meta-bsp/recipes-bsp/base-files/"
BBMASK += "meta-compulab/recipes-core/systemd/"
BBMASK += "meta-bsp-imx8mm/recipes-net/sftp"

PREFERRED_PROVIDER_virtual/kernel_iot-gate-imx8 = "linux-compulab"
PREFERRED_PROVIDER_virtual/bootloader_iot-gate-imx8 = "u-boot-compulab"
PREFERRED_RPROVIDER_u-boot-fw-utils_iot-gate-imx8 = "u-boot-compulab-fw-utils"

# These should be removed once the Modemmanager update
# is merged in meta-balena
PREFERRED_VERSION_libmbim = "1.28.4"
PREFERRED_VERSION_libqmi = "1.32.4"
PREFERRED_VERSION_modemmanager = "1.20.6"

CORE_IMAGE_EXTRA_INSTALL_iot-gate-imx8 += " cl-uboot cl-deploy u-boot-script "
CORE_IMAGE_EXTRA_INSTALL_iot-gate-imx8 += " u-boot-fw-utils modemmanager networkmanager linux-firmware-ax200"
CORE_IMAGE_EXTRA_INSTALL_remove = "firmware-imx-sdma-imx7d"

KERNEL_IMAGETYPE_iot-gate-imx8 = "Image.gz"

HOSTTOOLS_remove = " git-lfs "
HOSTTOOLS_remove = " bison "

FIRMWARE_COMPRESSION ?= "1"
